# 架构设计该从何入手

在软件开发过程中，我们经常会听到 **架构设计** 这个词。特别是在准备实现一个新的产品时，团队通常都会要求在开发之前先做架构设计，只有架构设计合理，最终开发出来的系统才会稳定、可扩展。

那么，架构设计到底该从哪里入手？正确的架构设计顺序是怎样的？每个步骤又有哪些需要注意的事项？这些问题很多同学一时可能很难回答清楚。其实，只要顺序处理得当，就能大幅提升架构设计的合理性和稳定性。

今天，我们结合 **1024 实训营** 的项目过程，为大家提供一个参考。

需要强调的是：架构设计讨论，团队参与的人越多越好。因为它是一项非常重要的共识。团队中有两个关键共识：

- 一个是 **产品要做成什么样**，对应的是产品原型设计；

- 另一个就是 **系统架构设计**。

回顾我们的实训项目过程，合理的项目顺序应该是：

`明确产品定位 → 定义产品原型与原型图 → 定义功能 API → 完成数据表设计 → 进行概要设计 → 模块详细设计`。

下面我们逐一展开。

---

## 明确产品定位

一个产品要做到什么程度？首先要明确产品定位，这是理清方向的前提。

例如：

- 我们是要做一个 **运维工具**，还是一个 **全托管运维系统**？

- 我们的用户群体是 **运维工程师**，还是 **研发团队**？

- 我们要解决的用户故事有哪些？哪些是必须优先实现的核心场景，哪些可以留到后续迭代？

这些问题都需要在产品定位阶段达成共识。

> 产品定位更多属于产品设计的范畴，本篇不作深入展开。

## 定义产品原型与原型图

在明确了产品定位后，就要整理产品所需的核心需求，也就是 **需求工程阶段**。这一步的关键，是将模糊的业务需求转化为清晰、可验证、无歧义的技术需求，它是后续设计和开发的唯一依据。

比较推荐的方法是：

- 产出产品原型图：用交互界面的方式收集、整理需求，明确每个界面的功能列表、功能划分、页面跳转关系。

- 通过原型图，可以较好覆盖需求清单，并合理整合到一起，使团队对产品的使用流程有更直观、统一的理解。

需要注意：

- 如果某个功能并不涉及界面（如 IDE 的功能扩展），可以用 **功能流程图** 表达。

- 大部分涉及用户交互的产品，都应该有原型图，来说明用户是如何使用系统的。

此外，在进行原型设计前，可以先画 **需求草图**，明确界面不变的核心要素，这样会让后续原型设计更高效。

同时，也要警惕：

- 避免 **过度设计**（设计了实际用不到的功能）。

- 避免 **伪需求**（例如某些功能更适合通过技术手段或特性实现，而不该以产品功能的方式存在）。

MVP（最小可行产品）思想也很重要：先聚焦产品最核心、不可或缺的功能。

## 定义功能 API

原型图确定后，每个页面的功能列表、需要展示的信息都已明确，接下来进入 **API 设计**。

经验总结：

1. API 设计要结合界面，但更要考虑 **逻辑关联性**。

  - 例如：界面需要获取某个服务的发布任务，可以设计为 `/v1/services/:service/deployments`；

  - 但如果系统需要支持多种关联查询，更合理的方式可能是 `/v1/deployments?service=serviceName`。

2. 避免过度通用的 **payload** 设计。

  - 不要把各种数据结构都往一个复杂的 payload 里塞，这样会导致解释成本高、依赖方难以理解。

  - 建议在定义 API 时，只包含 **明确且稳定** 的数据结构。

值得提醒的是：API 初版完成后，还不是最终定稿。等模块拆解完成后，还需要根据模块边界和耦合度对 API 做微调。

## 数据表定义

API 定义完成后，一般不直接拆模块，而是先定义 **数据表结构（ER 图）**。

原因是：

- 数据表本身也是模块划分的重要参考依据；

- 不同 API 操作哪些表，也会反映 API 与数据表的耦合关系。

在这个阶段，要把复杂的业务关系转化为结构化的数据库模型。

需要注意：

- 数据库选型会直接影响表设计范式。例如 Postgres 支持 ARRAY 类型，在某些场景下可以减少拆表，简化 ER 图。

- 避免过度设计。例如不必为了兼容多种数据库而抽象表结构，这种做法通常在现实中不会出现，现实中一般在数据库选型确定后，不会再轻易更改。

## 概要设计

完成 API 和数据表设计后，进入 **概要设计阶段**，主要目标是完成 **模块拆分**。

几个关键点：

1. 表的边界决定模块边界：通常不会有多个模块同时操作同一张表。

2. 代码量考虑：代码量大的功能值得独立成模块；反之则可以合并。

3. 耦合度：

   - 如果一个模块需要大量依赖另一个模块的私有 API，说明拆分不合理；

   - 如果模块只依赖公共 API 就能完成任务，则可以考虑独立出来。

在模块确定后，还需要理清模块之间的依赖关系，并合理使用 **依赖倒置** 原则，减少耦合，提高复用性。

## 模块详细设计

在概要设计完成后，需要将每个模块展开到可指导开发的程度，包括：

- 输入输出定义；

- 接口与数据结构；

- 内部逻辑分层；

- 关键流程图、类图等。

## 总结

架构设计并不是凭空展开，而是一个循序渐进的过程：

`明确产品定位 → 定义原型与原型图 → API 设计 → 数据表定义 → 概要设计 → 模块详细设计`。

每一步都建立在前一步的基础上，避免推倒重来。只有顺序合理，最终才能得到一个稳定、低耦合的系统架构。

希望通过本文，能让大家在面对新产品架构时，不再困惑于“从何入手”。